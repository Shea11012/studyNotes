## 文件共享

Unix 系统支持在不同进程间共享打开文件。

内核使用 3 种数据结构表示打开文件

1. 每个进程在进程表中都有一个记录项，记录项中包含一张打开文件描述符表，可将其视为一个矢量，每个描述符占用一项。
   - 文件描述符标志
   - 指向一个文件表项的指针
2. 内核为所有打开文件维持一张文件表。每个文件表项包含：
   - 文件状态标志（读、写、添写、同步和非阻塞等）
   - 当前文件偏移量
   - 指向该文件 v 节点表项的指针
3. 每个打开文件（或设备）都有一个 v 节点结构。v 节点包含了文件类型和对此文件进行各种操作函数的指针

**Tips：Linux 没有使用 v 节点，而使用了通用 i 节点结构。虽然实现有所不同，但概念上是一样的。**

### 原子操作

原子操作指的是由多步组成的一个操作。如果该操作原子的执行，则要么执行完所有步骤，要么一步也不执行，不会只执行所有步骤的一个子集。