go 提供了一个工具，可以在代码里检测竞争状态 `go build --race xxx.go`

### 原子操作

go 的 atomic 源码针对不同的操作系统有不同的汇编语言文件

#### CAS(compare-and-swap)

CAS 的意思是判断内存中的某个值是否等于 old 值，如果是的话，则赋 new 值给这块内存。CAS 比互斥锁乐观，但是也代表 CAS 有赋值不成功的时候，调用 CAS 的是时候需要处理赋值不成功时候的行为。

在 atomic 包中是 Compare 开头的函数

#### 增加或减少

对一个数值进行增加或减少的行为需要保证是原子的。

在 atomic 包中是以 Add 开头的函数。

#### 读取或写入

读取操作，在 atomic 包中是以 Load 开头的函数。

写入操作，在 atomic 包中是以 Store 开头的函数。



