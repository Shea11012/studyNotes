# 包和工具

### 包声明

包声明的三种情况：

1. 包对应一个可执行程序（main 包），main 包本身的导入路径是无关紧要的。名字为 main 的包是给 go build 构建命令一个信息，这个包编译完之后必须调用连接器生成一个可执行的程序。
2. 以 test.go 为后缀的 go 源文件并且包目录以 _test 为后缀。这种包是测试的外部扩展包，都由 go test 命令独立编译，普通包和测试的外部扩展包是相互独立的。
3. 一些版本管理工具会在导入路径后追加版本号信息，`gopkg.in/yaml.v2` 这种情况下包的名字并不包含版本号后缀，而是 yaml

### 导入包的重命名

```go
import (
	"crypto/rand"
    mrand "math/rand" // 包重命名
)
```

### 包的匿名导入

导入一个包而并不使用导入包会产生一个编译错误，但有时只是想利用导入包产生的副作用：会计算包级变量的初始化表达式和执行导入包的 init 初始化函数。

```go
import _ "image/png" // 这种被称为包的匿名导入
```

包的匿名导入，通常用来实现一个编译时机制

### 构建包

在包声明和包注释前面加注释：

```go
// +build ignore 有这个注释表示不编译该文件
// +build linux darwin 表示只在目标操作系统是 Linux 或 Mac OS 时才编译该文件
```

### 包文档

go 中，包中每个导出的成员和包声明前都应该包含目的和用法说明的注释。

### 内部包

为了将一个包暂时只暴露给一些受限制的用户使用。

go 对于包含了 internal 名字的路径段的包导入路径做了特殊处理，这种包叫 internal 包，一个 internal 包只能被和 internal 目录有同一个父目录的包所导入。例：

- net/http/internal/chunked 内部包只能被 net/http/httputil 或 net/http 包导入，但是不能被 net/url 包导入。

### 构建约束

- 以前缀 `+build` 开始，后跟一个或多个空格
- 位于文件顶部在保声明之前
- 它和包声明至少有一个空行，以防止被视为包文档

**构建约束指定以下规则：*

- 以 ！开头的构建标记是无效的
- 用空格分隔的构建标记在逻辑上是或
- 用逗号分隔的构建标记在逻辑上是和
- 在多行上构建的约束是逻辑和
- `ignore` 在任何不匹配有效架构或操作系统的上会构建