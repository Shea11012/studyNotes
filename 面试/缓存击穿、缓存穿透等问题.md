## 缓存穿透

#### 什么是缓存穿透

请求一条数据，缓存和数据库都查询补刀这条数据，但是请求每次都会命中到数据库上面去，这种查询不存在数据的现象被称为**缓存穿透**

#### 穿透带来的问题

如果有人恶意攻击，拿一个不存在的 id 去查询数据，会产生大量的请求到数据库去查询，可能导致数据库压力过大宕掉。

#### 解决办法

1. 在第一次查询时，发现这个数据为空，给这个 key 设置为 null 放到缓存里面去，后面的查询就可以直接返回 null。
2. 使用 BloomFilter ，设置一个集合，如果请求的 key  不存在这个集合内直接返回，如果存在则再查缓存或者数据库。



## 缓存击穿

#### 什么是击穿

大量的请求同时查询一个 key 时，此时这个 key 正好失效了，就会导致大量的请求都到数据库上面去，这种情况被称为**缓存击穿**。

#### 带来的问题

会造成某一时刻数据库请求量过大，压力剧增

#### 解决办法

上面的现象时多个线程同时去查询数据库的这条数据，可以在第一个查询数据请求上使用一个互斥锁锁住它。等第一个查询到数据做完缓存并释放锁，后面的线程就可以在缓存查到数据。

## 缓存雪崩

#### 什么是缓存雪崩

当某一时刻发生大规模的缓存失效的情况，如缓存服务器宕机，会有大量的请求进入到 DB 上面，导致 DB 挂掉。

#### 解决办法

1. 事前：使用集群缓存，保证缓存服务器的高可用
2. 事中：集群不可用时，使用本地缓存，并且限流保证 DB 不会挂掉。
3. 事后：开启 Redis 持久化机制，尽快恢复缓存集群。



## 热点数据集中失效的问题

#### 什么是集中失效

在设置缓存的时候，会给缓存设置一个失效时间，如果给缓存设置的失效时间是一致的，就会导致所有的缓存在同一时间失效。

#### 解决办法

1. 设置不同的失效时间，在一个基础时间上加上或减去一个随机值。



参考文章：

[关于缓存穿透等问题的解决]( https://juejin.im/post/5c9a67ac6fb9a070cb24bf34 )

