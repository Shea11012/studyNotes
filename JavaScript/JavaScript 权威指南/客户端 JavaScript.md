## web 浏览器中的JavaScript

JavaScript 程序的执行有两个阶段。

在第一个阶段，载入文档内容，并执行 `<script>` 元素里的代码（包括内联脚本和外部脚本），脚本按顺序执行。

当文档载入完成，并且所有脚本执行完成，JavaScript 执行进入第二个阶段。这个阶段是异步，而且是由事件驱动的。在事件驱动阶段，web 浏览器调用事件处理程序函数，来响应异步发生的事件，通常由用户输入和键盘按下、网络活动、运行事件和JavaScript 代码错误来触发。

JavaScript 是一个单线程执行模型，脚本和事件处理程序在同一时间只能执行一个，没有并发性。

#### 跨站脚本攻击

跨站脚本攻击（cross site scripting）XSS，是攻击者向目标 web 站点注入 HTML 标签或者脚本。



## 事件处理

#### 事件传播

事件传播三个阶段：

- 第一阶段：捕获

捕获阶段像反向的冒泡阶段，最先调用 window 对象的捕获处理程序，然后是 Document 对象的捕获处理程序，接着是 Body 对象，再然后是 Dom 对象，以此类推，直到调用事件目标的父元素的捕获事件处理程序。

- 第二阶段：目标对象本身的事件处理程序调用
- 第三阶段：冒泡

在调用在目标元素上注册的事件处理函数后，大部分事件会“冒泡”到 DOM 树根。调用目标的父元素的事件处理程序，然后调用在目标的祖父元素上注册的事件处理程序。这会一直到 Document 对象，最后到达 Window 对象。

#### 事件取消

``` javascript
# 取消事件的默认操作三种方式
event.preventDeafult()
event.returnValue = false; // 在 IE9 之前的 IE，可以设置 returnValue 属性为 false
return false;

# 取消事件相关的默认操作只是事件取消中的一种，也可以取消事件传播，在支持 addEventListener 的浏览器中
event.stopPropagation(); // 阻止事件的继续传播

```

## 客户端存储

#### localStorage 和 sessionStorage

两者的区别在于存储的有效期和作用域不同。

**localstorage：**

- 存储的数据是永久性的
- 作用域是限定在文档源（document origi）级别的，文档源是通过协议、主机名以及端口确定的。

**sessionStorage：**

- 有效期和存储数据是在脚本所在的最顶层窗口或者是浏览器标签，一旦窗口或者标签页被永久关闭，那么所有通过 sessionStorage 存储的数据也都被删除了。
- 作用域被限定在了文档源和窗口

